#!/usr/bin/env ruby
require 'p_version/binaries_yaml'
require 'p_version/migrations_yaml'

require 'optparse'

options = {}
OptionParser.new do |opts|
  executable_name = File.basename(__FILE__)
  opts.banner = <<BANNER
#{executable_name}: Bumps the alpha version of a pivotal product

Usage: #{executable_name} [options]
BANNER

  opts.on('--product-dir PATH', 'The path to the root of the product directory') do |product_dir|
    options[:product_dir] = product_dir
  end

  opts.on('--to-version VERSION', 'Version you want to set your product to.') do |to_version|
    options[:to_version] = to_version
  end
end.parse!

product_dir = options.fetch(:product_dir)
to_version = options[:to_version]

binaries_yaml = PVersion::BinariesYaml.build(product_dir, to_version)
migrations_yaml = PVersion::MigrationsYaml.build(product_dir, to_version)
puts "incrementing version from #{binaries_yaml.old_version} to #{binaries_yaml.new_version}"

binaries_yaml.bump_version_and_save
migrations_yaml.bump_version_and_save
